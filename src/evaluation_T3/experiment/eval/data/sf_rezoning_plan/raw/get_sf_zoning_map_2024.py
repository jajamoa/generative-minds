import requests
import json
from concurrent.futures import ThreadPoolExecutor
import re

# Initialize empty list to store all features
all_features = []

urls = [
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13677947.589461997%2C4539747.983914988%2C-13658379.710220996%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=0&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13677947.589461997%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13658379.710220996%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13658379.710220996%2C4539747.983914988%2C-13638811.830979995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=0&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13658379.710220996%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13638811.830979995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=0&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13619243.951738995%2C4539747.983914988%2C-13599676.072497996%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=0&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13619243.951738995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13599676.072497996%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13677947.589461997%2C4520180.104673987%2C-13658379.710220996%2C4539747.983914988&maxRecordCountFactor=4&resultOffset=0&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13677947.589461997%2C%22ymin%22%3A4520180.104673987%2C%22xmax%22%3A-13658379.710220996%2C%22ymax%22%3A4539747.983914988%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13658379.710220996%2C4520180.104673987%2C-13638811.830979995%2C4539747.983914988&maxRecordCountFactor=4&resultOffset=0&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13658379.710220996%2C%22ymin%22%3A4520180.104673987%2C%22xmax%22%3A-13638811.830979995%2C%22ymax%22%3A4539747.983914988%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4520180.104673987%2C-13619243.951738995%2C4539747.983914988&maxRecordCountFactor=4&resultOffset=0&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4520180.104673987%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4539747.983914988%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13619243.951738995%2C4520180.104673987%2C-13599676.072497996%2C4539747.983914988&maxRecordCountFactor=4&resultOffset=0&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13619243.951738995%2C%22ymin%22%3A4520180.104673987%2C%22xmax%22%3A-13599676.072497996%2C%22ymax%22%3A4539747.983914988%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=8000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=16000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4520180.104673987%2C-13619243.951738995%2C4539747.983914988&maxRecordCountFactor=4&resultOffset=8000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4520180.104673987%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4539747.983914988%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4520180.104673987%2C-13619243.951738995%2C4539747.983914988&maxRecordCountFactor=4&resultOffset=16000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4520180.104673987%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4539747.983914988%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=24000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=32000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=40000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=48000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=56000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=64000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=72000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=80000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=88000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=96000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=104000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=112000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=120000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=128000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100",
    "https://services.arcgis.com/Zs2aNLFN00jrS4gG/arcgis/rest/services/ProposedRezoning_Winter2023_PUBLIC/FeatureServer/3/query?f=geojson&geometry=-13638811.830979995%2C4539747.983914988%2C-13619243.951738995%2C4559315.863155987&maxRecordCountFactor=4&resultOffset=136000&resultRecordCount=8000&where=1%3D1&orderByFields=OBJECTID&outFields=NEW_HEIGHT%2COBJECTID&quantizationParameters=%7B%22extent%22%3A%7B%22xmin%22%3A-13638811.830979995%2C%22ymin%22%3A4539747.983914988%2C%22xmax%22%3A-13619243.951738995%2C%22ymax%22%3A4559315.863155987%7D%2C%22mode%22%3A%22view%22%2C%22originPosition%22%3A%22upperLeft%22%2C%22tolerance%22%3A38.21851414257816%7D&resultType=tile&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&defaultSR=102100"
]

# Add additional query parameters to each URL
urls = [
    url + "&outFields=*&outSR=4326" if "?" in url 
    else url + "?outFields=*&outSR=4326" 
    for url in urls
]

# Replace f=geojson with f=geojson in all URLs
urls = [url.replace("f=geojson", "f=geojson") for url in urls]

def extract_height_value(height_str):
    """Extract numerical height value from height string"""
    if not height_str:
        return None
    match = re.search(r'(\d+)', str(height_str))
    return int(match.group(1)) if match else None

def fetch_and_parse(url):
    """Download GeoJSON data and filter features where NEW_HEIGHT is not null"""
    print(f"Fetching: {url}")
    response = requests.get(url)
    if response.status_code == 200:
        try:
            data = response.json()
            if "features" in data:
                # Filter features where NEW_HEIGHT is not null or empty and NEW_HEIGHT_NUM is a number
                filtered_features = [
                    feature for feature in data["features"]
                    if (feature["properties"].get("NEW_HEIGHT") is not None 
                        and feature["properties"]["NEW_HEIGHT"] != ""
                        and isinstance(feature["properties"].get("NEW_HEIGHT_NUM"), (int, float))
                        and feature["properties"]["NEW_HEIGHT_NUM"] > 0)
                ]
                print(f"Parsed {len(filtered_features)} valid features from {url}")
                return filtered_features
            else:
                print(f"Warning: No features found in response")
                return []
        except Exception as e:
            print(f"Error parsing {url}: {e}")
            return []
    else:
        print(f"Failed to fetch {url}, status code: {response.status_code}")
        return []

# Use thread pool to speed up downloads
with ThreadPoolExecutor(max_workers=5) as executor:
    results = executor.map(fetch_and_parse, urls)

# Merge all features
for result in results:
    all_features.extend(result)

# Save to GeoJSON
geojson_data = {
    "type": "FeatureCollection",
    "crs": {
        "type": "name",
        "properties": {
            "name": "EPSG:4326"
        }
    },
    "features": all_features
}

with open("sf_zoning_2024.geojson", "w") as f:
    json.dump(geojson_data, f, indent=2)

print(f"GeoJSON saved as sf_zoning_2024.geojson with {len(all_features)} features") 